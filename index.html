<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPQC í’ˆì§ˆê´€ë¦¬ ì‹œìŠ¤í…œ v3.0 - Cloud Version</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif;
            background: #ffffff;
            padding: 0;
            margin: 0;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border: 1px solid #e0e0e0;
        }

        .header {
            background: #fafafa;
            padding: 20px 30px;
            border-bottom: 1px solid #e0e0e0;
        }

        .title-section {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
        }

        .search-icon {
            font-size: 24px;
            color: #666;
        }

        h1 {
            font-size: 24px;
            font-weight: bold;
        }

        .version-badge {
            background: #333;
            color: white;
            padding: 4px 10px;
            font-size: 11px;
            border: 1px solid #333;
        }

        .cloud-badge {
            background: white;
            color: #333;
            padding: 4px 10px;
            font-size: 11px;
            border: 1px solid #333;
        }

        /* ğŸ”— Google Sheets ì—°ê²° ìƒíƒœ í‘œì‹œ */
        .connection-status {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 4px 12px;
            font-size: 11px;
            border: 1px solid #e0e0e0;
            background: white;
            border-radius: 12px;
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #999;
        }

        .status-indicator.connected {
            background: #4CAF50;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .subtitle {
            color: #666;
            font-size: 14px;
            margin-left: 40px;
        }

        .language-tabs {
            display: flex;
            gap: 0;
            margin-top: 15px;
        }

        .lang-tab {
            padding: 10px 20px;
            border: none;
            background: #f0f0f0;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .lang-tab:first-child {
            border-radius: 5px 0 0 0;
        }

        .lang-tab.active {
            background: #333;
            color: white;
            border-bottom: 2px solid #333;
        }

        .lang-tab:hover:not(.active) {
            background: #e0e0e0;
        }

        .main-tabs {
            display: flex;
            border-bottom: 1px solid #e0e0e0;
            background: #fafafa;
        }

        .main-tab {
            padding: 15px 30px;
            border: none;
            background: #f0f0f0;
            cursor: pointer;
            font-size: 15px;
            font-weight: 500;
            transition: all 0.3s;
            border-right: 1px solid #e0e0e0;
        }

        .main-tab.active {
            background: white;
            border-bottom: 2px solid #333;
        }

        .main-tab:hover:not(.active) {
            background: #e8e8e8;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
            align-items: center;
        }

        label {
            font-size: 14px;
            color: #333;
            font-weight: 500;
        }

        select, input[type="text"], input[type="date"], input[type="time"] {
            padding: 8px 12px;
            border: 1px solid #e0e0e0;
            font-size: 14px;
            background: white;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #333;
        }

        button {
            padding: 10px 20px;
            background: #333;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        button:hover {
            background: #000;
        }

        button:active {
            transform: scale(0.98);
        }

        .table-wrapper {
            overflow-x: auto;
            border: 1px solid #e0e0e0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            min-width: 1000px;
        }

        th, td {
            padding: 10px;
            text-align: center;
            border: 1px solid #e0e0e0;
            font-size: 13px;
        }

        th {
            background: #fafafa;
            font-weight: 600;
            color: #333;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        td input, td select {
            width: 100%;
            padding: 6px;
            border: 1px solid #e0e0e0;
            font-size: 12px;
            box-sizing: border-box;
        }

        .item-label {
            font-weight: 600;
            color: #333;
            font-size: 12px;
            min-width: 100px;
            text-align: left;
            padding-left: 10px;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .stat-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            padding: 20px;
            background: white;
            border: 1px solid #e0e0e0;
            text-align: center;
        }

        .stat-card h3 {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
            font-weight: 500;
        }

        .stat-card .value {
            font-size: 32px;
            font-weight: bold;
            color: #333;
        }

        .chart-container {
            width: 100%;
            max-width: 800px;
            margin: 30px auto;
            padding: 20px;
            background: white;
            border: 1px solid #e0e0e0;
        }

        .search-section {
            background: #fafafa;
            padding: 20px;
            border: 1px solid #e0e0e0;
            margin-bottom: 20px;
        }

        .search-inputs {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .result-table {
            margin-top: 20px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border: 1px solid #e0e0e0;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }

        .modal-header h2 {
            font-size: 20px;
            color: #333;
        }

        .close {
            color: #666;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s;
        }

        .close:hover {
            color: #000;
        }

        .detail-table {
            width: 100%;
        }

        .detail-table th {
            background: #fafafa;
            text-align: left;
            padding: 12px;
            font-weight: 600;
            width: 40%;
        }

        .detail-table td {
            text-align: left;
            padding: 12px;
        }

        .btn-view {
            padding: 6px 15px;
            background: #333;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 12px;
        }

        .btn-view:hover {
            background: #000;
        }

        @media (max-width: 768px) {
            .container {
                border: none;
            }

            .controls {
                flex-direction: column;
                align-items: stretch;
            }

            .stat-cards {
                grid-template-columns: 1fr;
            }

            .main-tab {
                padding: 12px 15px;
                font-size: 13px;
            }

            .button-group {
                flex-direction: column;
            }

            button {
                width: 100%;
            }
        }

        /* í•„ìˆ˜ ì…ë ¥ í•­ëª© í‘œì‹œ */
        .required-field::after {
            content: " *";
            color: #d32f2f;
            font-weight: bold;
        }

        .validation-error {
            border-color: #d32f2f !important;
            background-color: #ffebee !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="title-section">
                <span class="search-icon">ğŸ”</span>
                <h1 id="mainTitle">IPQC í’ˆì§ˆê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
                <span class="version-badge">v3.0</span>
                <span class="cloud-badge" id="cloudBadge">â˜ï¸ Cloud</span>
                <span class="connection-status">
                    <span class="status-indicator" id="statusIndicator"></span>
                    <span id="connectionStatus">ì—°ê²° ì•ˆë¨</span>
                </span>
            </div>
            <div class="subtitle" id="subtitle">In-Process Quality Control Management System</div>
            
            <div class="language-tabs">
                <button class="lang-tab active" data-lang="ko" id="langKo">í•œêµ­ì–´ Korean</button>
                <button class="lang-tab" data-lang="en" id="langEn">ì˜ì–´ English</button>
                <button class="lang-tab" data-lang="zh" id="langZh">ì¤‘êµ­ì–´ ä¸­æ–‡</button>
                <button class="lang-tab" data-lang="vi" id="langVi">ë² íŠ¸ë‚¨ì–´ Tiáº¿ng Viá»‡t</button>
                <button class="lang-tab" data-lang="id" id="langId">ì¸ë„ë„¤ì‹œì•„ì–´ Bahasa</button>
            </div>
        </div>

        <div class="main-tabs">
            <button class="main-tab active" data-tab="input" id="tabInput">ë°ì´í„° ì…ë ¥</button>
            <button class="main-tab" data-tab="query" id="tabQuery">ë°ì´í„° ì¡°íšŒ</button>
            <button class="main-tab" data-tab="stats" id="tabStats">í†µê³„</button>
            <button class="main-tab" data-tab="settings" id="tabSettings">âš™ï¸ ì„¤ì •</button>
        </div>

        <!-- ë°ì´í„° ì…ë ¥ íƒ­ -->
        <div class="tab-content active" id="content-input">
            <div class="controls">
                <label for="equipmentCount" id="labelEquipment">ê²€ì‚¬ ì¥ë¹„ ìˆ˜:</label>
                <select id="equipmentCount">
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5" selected>5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                    <option value="10">10</option>
                </select>
                <button onclick="generateColumns()" id="btnGenerate">ì—´ ìƒì„±</button>
            </div>

            <div class="table-wrapper">
                <table id="dataTable">
                    <thead>
                        <tr id="tableHeader">
                            <th id="thItem">í•­ëª©</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody"></tbody>
                </table>
            </div>

            <div class="button-group">
                <button onclick="fillCommonData()" id="btnFillCommon">ê³µí†µì •ë³´ ìë™ì±„ìš°ê¸°</button>
                <button onclick="saveToGoogleSheets()" id="btnSave">Google Sheetsì— ì €ì¥</button>
                <button onclick="saveAllDataToExcel()" id="btnExcel">í˜„ì¬ ë°ì´í„° Excel ì €ì¥</button>
                <button onclick="clearAllData()" id="btnClear">ì „ì²´ ì´ˆê¸°í™”</button>
            </div>
        </div>

        <!-- ë°ì´í„° ì¡°íšŒ íƒ­ -->
        <div class="tab-content" id="content-query">
            <div class="search-section">
                <h3 id="searchTitle">ê²€ìƒ‰ ì¡°ê±´</h3>
                <div class="search-inputs">
                    <label for="searchDate" id="labelSearchDate">ë‚ ì§œ:</label>
                    <input type="date" id="searchDate">
                    
                    <label for="searchProduct" id="labelSearchProduct">ì œí’ˆ:</label>
                    <input type="text" id="searchProduct" placeholder="Description ë£Œè™Ÿ">
                    
                    <button onclick="searchData()" id="btnSearch">ê²€ìƒ‰</button>
                    <button onclick="clearSearch()" id="btnClearSearch">ì´ˆê¸°í™”</button>
                    <button onclick="loadAllDataFromGoogleSheets()" id="btnRefresh">Google Sheets ì „ì²´ ë°ì´í„° ìƒˆë¡œê³ ì¹¨</button>
                    <button onclick="saveQueryDataToExcel()" id="btnExportAll">ì „ì²´ ë°ì´í„° Excel ë‚´ë³´ë‚´ê¸°</button>
                </div>
            </div>

            <div class="result-table">
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th id="thDate">ë‚ ì§œ</th>
                                <th id="thTime">ì‹œê°„</th>
                                <th id="thMachine">ê¸°ê³„</th>
                                <th id="thCustomer">ê³ ê°</th>
                                <th id="thDescription">ì œí’ˆ</th>
                                <th id="thDetail">ìƒì„¸ë³´ê¸°</th>
                            </tr>
                        </thead>
                        <tbody id="queryTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- í†µê³„ íƒ­ -->
        <div class="tab-content" id="content-stats">
            <div class="stat-cards">
                <div class="stat-card">
                    <h3 id="statTotal">ì´ ê²€ì‚¬ ê±´ìˆ˜</h3>
                    <div class="value" id="totalInspections">0</div>
                </div>
                <div class="stat-card">
                    <h3 id="statPass">í•©ê²©ë¥ </h3>
                    <div class="value" id="passRate">0%</div>
                </div>
                <div class="stat-card">
                    <h3 id="statFail">ë¶ˆëŸ‰ ê±´ìˆ˜</h3>
                    <div class="value" id="failCount">0</div>
                </div>
                <div class="stat-card">
                    <h3 id="statWeek">ì£¼ê°„ ê²€ì‚¬</h3>
                    <div class="value" id="weeklyCount">0</div>
                </div>
            </div>

            <div class="chart-container">
                <h3 id="chartTitle1">ê²€ì‚¬ ê²°ê³¼ ë¶„í¬</h3>
                <canvas id="resultChart"></canvas>
            </div>

            <div class="chart-container">
                <h3 id="chartTitle2">ì›”ë³„ ê²€ì‚¬ ì¶”ì´</h3>
                <canvas id="monthlyChart"></canvas>
            </div>
        </div>

        <!-- ì„¤ì • íƒ­ -->
        <div class="tab-content" id="content-settings">
            <h2 id="settingsTitle">Google Sheets ì„¤ì •</h2>
            <p id="settingsDesc">Google Apps Script Web App URLì„ ì…ë ¥í•˜ì„¸ìš”:</p>
            <input type="text" id="googleScriptUrl" placeholder="https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec" style="width: 100%; margin: 10px 0;">
            <button onclick="saveSettings()" id="btnSaveSettings">ì„¤ì • ì €ì¥</button>
            <button onclick="testConnection()" id="btnTestConnection">ì—°ê²° í…ŒìŠ¤íŠ¸</button>
            
            <div style="margin-top: 30px; padding: 20px; background: #fafafa; border: 1px solid #e0e0e0;">
                <h3 id="guideTitle">ì„¤ì • ê°€ì´ë“œ</h3>
                <ol id="guideSteps" style="line-height: 1.8;">
                    <li><strong>Google Sheets</strong> ìƒˆ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ìƒì„±</li>
                    <li><strong>í™•ì¥ í”„ë¡œê·¸ë¨ > Apps Script</strong> ì„ íƒ</li>
                    <li>ì•„ë˜ ì½”ë“œ ë¶™ì—¬ë„£ê¸° (ê¸°ì¡´ ì½”ë“œ ëª¨ë‘ ì‚­ì œ)</li>
                    <li><strong>ë°°í¬ > ìƒˆ ë°°í¬ > ì›¹ ì•±</strong> ì„ íƒ</li>
                    <li><strong>ì•¡ì„¸ìŠ¤ ê¶Œí•œ: "ëª¨ë“  ì‚¬ìš©ì"</strong>ë¡œ ì„¤ì • (âš ï¸ í•„ìˆ˜!)</li>
                    <li>ë°°í¬ URLì„ ë³µì‚¬í•˜ì—¬ ìœ„ ì…ë ¥ë€ì— ë¶™ì—¬ë„£ê¸°</li>
                    <li><strong>"ì—°ê²° í…ŒìŠ¤íŠ¸"</strong> ë²„íŠ¼ í´ë¦­í•˜ì—¬ í™•ì¸</li>
                </ol>
                
                <div style="margin: 20px 0; padding: 15px; background: #fff3cd; border: 1px solid #ffc107; border-radius: 4px;">
                    <strong>âš ï¸ ì¤‘ìš” ì£¼ì˜ì‚¬í•­:</strong>
                    <ul style="margin: 10px 0 0 20px; line-height: 1.8;">
                        <li>URLì€ ë°˜ë“œì‹œ <code style="background: white; padding: 2px 6px; border: 1px solid #e0e0e0;">/exec</code>ë¡œ ëë‚˜ì•¼ í•©ë‹ˆë‹¤</li>
                        <li>ì•¡ì„¸ìŠ¤ ê¶Œí•œì„ "ëª¨ë“  ì‚¬ìš©ì"ë¡œ ì„¤ì •í•˜ì§€ ì•Šìœ¼ë©´ ì—°ê²° ì‹¤íŒ¨</li>
                        <li>ë°°í¬ í›„ ìƒˆ URLì´ ìƒì„±ë˜ë©´ ì—¬ê¸°ì— ë‹¤ì‹œ ì…ë ¥í•´ì•¼ í•¨</li>
                        <li>ì²« ì—°ê²° ì‹œ ì‘ë‹µì´ ëŠë¦´ ìˆ˜ ìˆìŒ (ìµœëŒ€ 30ì´ˆ ëŒ€ê¸°)</li>
                    </ul>
                </div>
                
                <h4 id="codeTitle">Apps Script ì½”ë“œ:</h4>
                <div style="margin-bottom: 10px;">
                    <button onclick="copyScriptCode()" style="padding: 8px 16px; font-size: 13px;">ğŸ“‹ ì½”ë“œ ë³µì‚¬</button>
                </div>
                <pre style="background: white; padding: 15px; border: 1px solid #e0e0e0; overflow-x: auto; font-size: 12px;">
function doPost(e) {
  const sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();
  const data = JSON.parse(e.postData.contents);
  
  if (data.action === 'save') {
    const values = data.values;
    sheet.appendRow(values);
    return ContentService.createTextOutput(JSON.stringify({success: true}));
  }
  
  if (data.action === 'load') {
    const lastRow = sheet.getLastRow();
    if (lastRow < 2) return ContentService.createTextOutput(JSON.stringify({data: []}));
    const values = sheet.getRange(lastRow, 1, 1, sheet.getLastColumn()).getValues()[0];
    return ContentService.createTextOutput(JSON.stringify({data: values}));
  }
  
  if (data.action === 'loadAll') {
    const lastRow = sheet.getLastRow();
    if (lastRow < 2) return ContentService.createTextOutput(JSON.stringify({data: []}));
    const values = sheet.getRange(2, 1, lastRow - 1, sheet.getLastColumn()).getValues();
    return ContentService.createTextOutput(JSON.stringify({data: values}));
  }
}

function doGet(e) {
  return ContentService.createTextOutput(JSON.stringify({status: 'ok', message: 'IPQC System Connected'}));
}</pre>
            </div>
        </div>
    </div>

    <!-- ìƒì„¸ë³´ê¸° ëª¨ë‹¬ -->
    <div id="detailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">ê²€ì‚¬ ìƒì„¸ ì •ë³´</h2>
                <span class="close" onclick="closeDetailModal()">&times;</span>
            </div>
            <table class="detail-table" id="detailTable"></table>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // ğŸŒ ë‹¤êµ­ì–´ ì§€ì›
        const translations = {
            ko: {
                mainTitle: 'IPQC í’ˆì§ˆê´€ë¦¬ ì‹œìŠ¤í…œ',
                cloudBadge: 'â˜ï¸ Cloud',
                subtitle: 'In-Process Quality Control Management System',
                connectionStatus: {
                    connected: 'ì—°ê²°ë¨',
                    disconnected: 'ì—°ê²° ì•ˆë¨'
                },
                langKo: 'í•œêµ­ì–´ Korean',
                langEn: 'ì˜ì–´ English',
                langZh: 'ì¤‘êµ­ì–´ ä¸­æ–‡',
                langVi: 'ë² íŠ¸ë‚¨ì–´ Tiáº¿ng Viá»‡t',
                langId: 'ì¸ë„ë„¤ì‹œì•„ì–´ Bahasa',
                tabInput: 'ë°ì´í„° ì…ë ¥',
                tabQuery: 'ë°ì´í„° ì¡°íšŒ',
                tabStats: 'í†µê³„',
                tabSettings: 'âš™ï¸ ì„¤ì •',
                labelEquipment: 'ê²€ì‚¬ ì¥ë¹„ ìˆ˜:',
                btnGenerate: 'ì—´ ìƒì„±',
                thItem: 'í•­ëª©',
                btnFillCommon: 'ê³µí†µì •ë³´ ìë™ì±„ìš°ê¸°',
                btnSave: 'Google Sheetsì— ì €ì¥',
                btnExcel: 'í˜„ì¬ ë°ì´í„° Excel ì €ì¥',
                btnClear: 'ì „ì²´ ì´ˆê¸°í™”',
                searchTitle: 'ê²€ìƒ‰ ì¡°ê±´',
                labelSearchDate: 'ë‚ ì§œ:',
                labelSearchProduct: 'ì œí’ˆ:',
                btnSearch: 'ê²€ìƒ‰',
                btnClearSearch: 'ì´ˆê¸°í™”',
                btnRefresh: 'Google Sheets ì „ì²´ ë°ì´í„° ìƒˆë¡œê³ ì¹¨',
                btnExportAll: 'ì „ì²´ ë°ì´í„° Excel ë‚´ë³´ë‚´ê¸°',
                thDate: 'ë‚ ì§œ',
                thTime: 'ì‹œê°„',
                thMachine: 'ê¸°ê³„',
                thCustomer: 'ê³ ê°',
                thDescription: 'ì œí’ˆ',
                thDetail: 'ìƒì„¸ë³´ê¸°',
                statTotal: 'ì´ ê²€ì‚¬ ê±´ìˆ˜',
                statPass: 'í•©ê²©ë¥ ',
                statFail: 'ë¶ˆëŸ‰ ê±´ìˆ˜',
                statWeek: 'ì£¼ê°„ ê²€ì‚¬',
                chartTitle1: 'ê²€ì‚¬ ê²°ê³¼ ë¶„í¬',
                chartTitle2: 'ì›”ë³„ ê²€ì‚¬ ì¶”ì´',
                settingsTitle: 'Google Sheets ì„¤ì •',
                settingsDesc: 'Google Apps Script Web App URLì„ ì…ë ¥í•˜ì„¸ìš”:',
                btnSaveSettings: 'ì„¤ì • ì €ì¥',
                btnTestConnection: 'ì—°ê²° í…ŒìŠ¤íŠ¸',
                guideTitle: 'ì„¤ì • ê°€ì´ë“œ',
                codeTitle: 'Apps Script ì½”ë“œ:',
                modalTitle: 'ê²€ì‚¬ ìƒì„¸ ì •ë³´',
                btnView: 'ìƒì„¸ë³´ê¸°',
                // ì°¨íŠ¸ ë ˆì´ë¸”
                chartLabels: {
                    ok: 'í•©ê²©',
                    ng: 'ë¶ˆí•©ê²©',
                    other: 'ê¸°íƒ€',
                    result: 'ê²°ê³¼',
                    count: 'ê±´ìˆ˜',
                    month: 'ì›”',
                    inspections: 'ê²€ì‚¬ ê±´ìˆ˜'
                },
                // ì•Œë¦¼ ë©”ì‹œì§€
                alerts: {
                    saveSuccess: 'ë°ì´í„°ê°€ Google Sheetsì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!\n(CORS ê²½ê³ ëŠ” ë¬´ì‹œí•˜ì„¸ìš” - ë°ì´í„°ëŠ” ì •ìƒ ì €ì¥ë¨)',
                    saveError: 'ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.',
                    loadSuccess: 'ìµœì‹  ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤!',
                    loadError: 'ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨',
                    noData: 'ì €ì¥ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.',
                    refreshSuccess: 'ì „ì²´ ë°ì´í„°ë¥¼ ìƒˆë¡œê³ ì¹¨í–ˆìŠµë‹ˆë‹¤!',
                    refreshError: 'ìƒˆë¡œê³ ì¹¨ ì¤‘ ì˜¤ë¥˜ ë°œìƒ',
                    clearConfirm: 'ëª¨ë“  ì…ë ¥ ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?',
                    settingsSaved: 'ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!',
                    connectionSuccess: 'ì—°ê²° ì„±ê³µ! Google Sheetsì™€ í†µì‹  ê°€ëŠ¥í•©ë‹ˆë‹¤.',
                    connectionError: 'ì—°ê²° ì‹¤íŒ¨. URLì„ í™•ì¸í•´ì£¼ì„¸ìš”.',
                    urlRequired: 'Google Apps Script URLì„ ë¨¼ì € ì„¤ì •í•´ì£¼ì„¸ìš”!',
                    validationError: 'í•„ìˆ˜ ì…ë ¥ í•­ëª©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”!\n\ní•„ìˆ˜ í•­ëª©:\n- DATE æ—¥æœŸ\n- M/C æ©Ÿå°\n- QC inspector æª¢é©—å“¡\n- Description æ–™è™Ÿ\n- RESULTçµæœ'
                }
            },
            en: {
                mainTitle: 'IPQC Quality Management System',
                cloudBadge: 'â˜ï¸ Cloud',
                subtitle: 'In-Process Quality Control Management System',
                connectionStatus: {
                    connected: 'Connected',
                    disconnected: 'Disconnected'
                },
                langKo: 'Korean í•œêµ­ì–´',
                langEn: 'English ì˜ì–´',
                langZh: 'Chinese ä¸­æ–‡',
                langVi: 'Vietnamese Tiáº¿ng Viá»‡t',
                langId: 'Indonesian Bahasa',
                tabInput: 'Data Input',
                tabQuery: 'Data Query',
                tabStats: 'Statistics',
                tabSettings: 'âš™ï¸ Settings',
                labelEquipment: 'Equipment Count:',
                btnGenerate: 'Generate Columns',
                thItem: 'Item',
                btnFillCommon: 'Auto-fill Common Info',
                btnSave: 'Save to Google Sheets',
                btnExcel: 'Export Current Data',
                btnClear: 'Clear All',
                searchTitle: 'Search Criteria',
                labelSearchDate: 'Date:',
                labelSearchProduct: 'Product:',
                btnSearch: 'Search',
                btnClearSearch: 'Clear',
                btnRefresh: 'Refresh All Data from Google Sheets',
                btnExportAll: 'Export All Data to Excel',
                thDate: 'Date',
                thTime: 'Time',
                thMachine: 'Machine',
                thCustomer: 'Customer',
                thDescription: 'Product',
                thDetail: 'Details',
                statTotal: 'Total Inspections',
                statPass: 'Pass Rate',
                statFail: 'Failed Count',
                statWeek: 'Weekly Count',
                chartTitle1: 'Inspection Result Distribution',
                chartTitle2: 'Monthly Inspection Trends',
                settingsTitle: 'Google Sheets Settings',
                settingsDesc: 'Enter Google Apps Script Web App URL:',
                btnSaveSettings: 'Save Settings',
                btnTestConnection: 'Test Connection',
                guideTitle: 'Setup Guide',
                codeTitle: 'Apps Script Code:',
                modalTitle: 'Inspection Details',
                btnView: 'View Details',
                chartLabels: {
                    ok: 'Pass',
                    ng: 'Fail',
                    other: 'Other',
                    result: 'Result',
                    count: 'Count',
                    month: 'Month',
                    inspections: 'Inspections'
                },
                alerts: {
                    saveSuccess: 'Data saved to Google Sheets successfully!\n(Ignore CORS warning - data is saved)',
                    saveError: 'Error occurred while saving.',
                    loadSuccess: 'Latest data loaded successfully!',
                    loadError: 'Failed to load data',
                    noData: 'No saved data found.',
                    refreshSuccess: 'All data refreshed successfully!',
                    refreshError: 'Error occurred during refresh',
                    clearConfirm: 'Do you want to clear all input data?',
                    settingsSaved: 'Settings saved successfully!',
                    connectionSuccess: 'Connection successful! Can communicate with Google Sheets.',
                    connectionError: 'Connection failed. Please check URL.',
                    urlRequired: 'Please set Google Apps Script URL first!',
                    validationError: 'Please fill in all required fields!\n\nRequired fields:\n- DATE\n- M/C\n- QC inspector\n- Description\n- RESULT'
                }
            },
            zh: {
                mainTitle: 'IPQC å“è³ªç®¡ç†ç³»çµ±',
                cloudBadge: 'â˜ï¸ é›²ç«¯',
                subtitle: 'è£½ç¨‹å“è³ªæ§åˆ¶ç®¡ç†ç³»çµ±',
                connectionStatus: {
                    connected: 'å·²é€£æ¥',
                    disconnected: 'æœªé€£æ¥'
                },
                langKo: 'éŸ“èª í•œêµ­ì–´',
                langEn: 'è‹±èª English',
                langZh: 'ä¸­æ–‡ ä¸­æ–‡',
                langVi: 'è¶Šå—èª Tiáº¿ng Viá»‡t',
                langId: 'å°å°¼èª Bahasa',
                tabInput: 'æ•¸æ“šè¼¸å…¥',
                tabQuery: 'æ•¸æ“šæŸ¥è©¢',
                tabStats: 'çµ±è¨ˆ',
                tabSettings: 'âš™ï¸ è¨­ç½®',
                labelEquipment: 'æª¢æŸ¥è¨­å‚™æ•¸:',
                btnGenerate: 'ç”Ÿæˆåˆ—',
                thItem: 'é …ç›®',
                btnFillCommon: 'è‡ªå‹•å¡«å……å…±åŒä¿¡æ¯',
                btnSave: 'ä¿å­˜åˆ° Google Sheets',
                btnExcel: 'å°å‡ºç•¶å‰æ•¸æ“š',
                btnClear: 'å…¨éƒ¨æ¸…é™¤',
                searchTitle: 'æœç´¢æ¢ä»¶',
                labelSearchDate: 'æ—¥æœŸ:',
                labelSearchProduct: 'ç”¢å“:',
                btnSearch: 'æœç´¢',
                btnClearSearch: 'æ¸…é™¤',
                btnRefresh: 'å¾ Google Sheets åˆ·æ–°æ‰€æœ‰æ•¸æ“š',
                btnExportAll: 'å°å‡ºæ‰€æœ‰æ•¸æ“šåˆ° Excel',
                thDate: 'æ—¥æœŸ',
                thTime: 'æ™‚é–“',
                thMachine: 'æ©Ÿå™¨',
                thCustomer: 'å®¢æˆ¶',
                thDescription: 'ç”¢å“',
                thDetail: 'è©³æƒ…',
                statTotal: 'ç¸½æª¢æŸ¥æ•¸',
                statPass: 'åˆæ ¼ç‡',
                statFail: 'ä¸è‰¯æ•¸',
                statWeek: 'æ¯é€±æª¢æŸ¥',
                chartTitle1: 'æª¢æŸ¥çµæœåˆ†ä½ˆ',
                chartTitle2: 'æœˆåº¦æª¢æŸ¥è¶¨å‹¢',
                settingsTitle: 'Google Sheets è¨­ç½®',
                settingsDesc: 'è¼¸å…¥ Google Apps Script Web App URL:',
                btnSaveSettings: 'ä¿å­˜è¨­ç½®',
                btnTestConnection: 'æ¸¬è©¦é€£æ¥',
                guideTitle: 'è¨­ç½®æŒ‡å—',
                codeTitle: 'Apps Script ä»£ç¢¼:',
                modalTitle: 'æª¢æŸ¥è©³æƒ…',
                btnView: 'æŸ¥çœ‹è©³æƒ…',
                chartLabels: {
                    ok: 'åˆæ ¼',
                    ng: 'ä¸åˆæ ¼',
                    other: 'å…¶ä»–',
                    result: 'çµæœ',
                    count: 'æ•¸é‡',
                    month: 'æœˆ',
                    inspections: 'æª¢æŸ¥æ•¸'
                },
                alerts: {
                    saveSuccess: 'æ•¸æ“šå·²æˆåŠŸä¿å­˜åˆ° Google Sheetsï¼\nï¼ˆå¿½ç•¥ CORS è­¦å‘Š - æ•¸æ“šå·²ä¿å­˜ï¼‰',
                    saveError: 'ä¿å­˜æ™‚ç™¼ç”ŸéŒ¯èª¤ã€‚',
                    loadSuccess: 'æœ€æ–°æ•¸æ“šå·²åŠ è¼‰ï¼',
                    loadError: 'åŠ è¼‰æ•¸æ“šå¤±æ•—',
                    noData: 'æ²’æœ‰ä¿å­˜çš„æ•¸æ“šã€‚',
                    refreshSuccess: 'æ‰€æœ‰æ•¸æ“šå·²åˆ·æ–°ï¼',
                    refreshError: 'åˆ·æ–°æ™‚ç™¼ç”ŸéŒ¯èª¤',
                    clearConfirm: 'æ‚¨è¦æ¸…é™¤æ‰€æœ‰è¼¸å…¥æ•¸æ“šå—ï¼Ÿ',
                    settingsSaved: 'è¨­ç½®å·²ä¿å­˜ï¼',
                    connectionSuccess: 'é€£æ¥æˆåŠŸï¼å¯ä»¥èˆ‡ Google Sheets é€šä¿¡ã€‚',
                    connectionError: 'é€£æ¥å¤±æ•—ã€‚è«‹æª¢æŸ¥ URLã€‚',
                    urlRequired: 'è«‹å…ˆè¨­ç½® Google Apps Script URLï¼',
                    validationError: 'è«‹å¡«å¯«æ‰€æœ‰å¿…å¡«é …ï¼\n\nå¿…å¡«é …ï¼š\n- DATE æ—¥æœŸ\n- M/C æ©Ÿå°\n- QC inspector æª¢é©—å“¡\n- Description æ–™è™Ÿ\n- RESULTçµæœ'
                }
            },
            vi: {
                mainTitle: 'Há»‡ Thá»‘ng Quáº£n LÃ½ Cháº¥t LÆ°á»£ng IPQC',
                cloudBadge: 'â˜ï¸ ÄÃ¡m MÃ¢y',
                subtitle: 'Há»‡ Thá»‘ng Quáº£n LÃ½ Kiá»ƒm SoÃ¡t Cháº¥t LÆ°á»£ng Trong QuÃ¡ TrÃ¬nh',
                connectionStatus: {
                    connected: 'ÄÃ£ káº¿t ná»‘i',
                    disconnected: 'ChÆ°a káº¿t ná»‘i'
                },
                langKo: 'Tiáº¿ng HÃ n í•œêµ­ì–´',
                langEn: 'Tiáº¿ng Anh English',
                langZh: 'Tiáº¿ng Trung ä¸­æ–‡',
                langVi: 'Tiáº¿ng Viá»‡t Tiáº¿ng Viá»‡t',
                langId: 'Tiáº¿ng Indonesia Bahasa',
                tabInput: 'Nháº­p Dá»¯ Liá»‡u',
                tabQuery: 'Truy Váº¥n Dá»¯ Liá»‡u',
                tabStats: 'Thá»‘ng KÃª',
                tabSettings: 'âš™ï¸ CÃ i Äáº·t',
                labelEquipment: 'Sá»‘ Thiáº¿t Bá»‹:',
                btnGenerate: 'Táº¡o Cá»™t',
                thItem: 'Má»¥c',
                btnFillCommon: 'Tá»± Äá»™ng Äiá»n ThÃ´ng Tin Chung',
                btnSave: 'LÆ°u vÃ o Google Sheets',
                btnExcel: 'Xuáº¥t Dá»¯ Liá»‡u Hiá»‡n Táº¡i',
                btnClear: 'XÃ³a Táº¥t Cáº£',
                searchTitle: 'TiÃªu ChÃ­ TÃ¬m Kiáº¿m',
                labelSearchDate: 'NgÃ y:',
                labelSearchProduct: 'Sáº£n Pháº©m:',
                btnSearch: 'TÃ¬m Kiáº¿m',
                btnClearSearch: 'XÃ³a',
                btnRefresh: 'LÃ m Má»›i Táº¥t Cáº£ Dá»¯ Liá»‡u tá»« Google Sheets',
                btnExportAll: 'Xuáº¥t Táº¥t Cáº£ Dá»¯ Liá»‡u sang Excel',
                thDate: 'NgÃ y',
                thTime: 'Thá»i Gian',
                thMachine: 'MÃ¡y',
                thCustomer: 'KhÃ¡ch HÃ ng',
                thDescription: 'Sáº£n Pháº©m',
                thDetail: 'Chi Tiáº¿t',
                statTotal: 'Tá»•ng Sá»‘ Kiá»ƒm Tra',
                statPass: 'Tá»· Lá»‡ Äáº¡t',
                statFail: 'Sá»‘ Lá»—i',
                statWeek: 'Kiá»ƒm Tra HÃ ng Tuáº§n',
                chartTitle1: 'PhÃ¢n Bá»‘ Káº¿t Quáº£ Kiá»ƒm Tra',
                chartTitle2: 'Xu HÆ°á»›ng Kiá»ƒm Tra HÃ ng ThÃ¡ng',
                settingsTitle: 'CÃ i Äáº·t Google Sheets',
                settingsDesc: 'Nháº­p URL Google Apps Script Web App:',
                btnSaveSettings: 'LÆ°u CÃ i Äáº·t',
                btnTestConnection: 'Kiá»ƒm Tra Káº¿t Ná»‘i',
                guideTitle: 'HÆ°á»›ng Dáº«n CÃ i Äáº·t',
                codeTitle: 'MÃ£ Apps Script:',
                modalTitle: 'Chi Tiáº¿t Kiá»ƒm Tra',
                btnView: 'Xem Chi Tiáº¿t',
                chartLabels: {
                    ok: 'Äáº¡t',
                    ng: 'KhÃ´ng Äáº¡t',
                    other: 'KhÃ¡c',
                    result: 'Káº¿t Quáº£',
                    count: 'Sá»‘ LÆ°á»£ng',
                    month: 'ThÃ¡ng',
                    inspections: 'Kiá»ƒm Tra'
                },
                alerts: {
                    saveSuccess: 'Dá»¯ liá»‡u Ä‘Ã£ Ä‘Æ°á»£c lÆ°u vÃ o Google Sheets!\n(Bá» qua cáº£nh bÃ¡o CORS - dá»¯ liá»‡u Ä‘Ã£ Ä‘Æ°á»£c lÆ°u)',
                    saveError: 'Lá»—i xáº£y ra khi lÆ°u.',
                    loadSuccess: 'ÄÃ£ táº£i dá»¯ liá»‡u má»›i nháº¥t!',
                    loadError: 'KhÃ´ng thá»ƒ táº£i dá»¯ liá»‡u',
                    noData: 'KhÃ´ng cÃ³ dá»¯ liá»‡u Ä‘Ã£ lÆ°u.',
                    refreshSuccess: 'Táº¥t cáº£ dá»¯ liá»‡u Ä‘Ã£ Ä‘Æ°á»£c lÃ m má»›i!',
                    refreshError: 'Lá»—i xáº£y ra khi lÃ m má»›i',
                    clearConfirm: 'Báº¡n cÃ³ muá»‘n xÃ³a táº¥t cáº£ dá»¯ liá»‡u nháº­p khÃ´ng?',
                    settingsSaved: 'CÃ i Ä‘áº·t Ä‘Ã£ Ä‘Æ°á»£c lÆ°u!',
                    connectionSuccess: 'Káº¿t ná»‘i thÃ nh cÃ´ng! CÃ³ thá»ƒ giao tiáº¿p vá»›i Google Sheets.',
                    connectionError: 'Káº¿t ná»‘i tháº¥t báº¡i. Vui lÃ²ng kiá»ƒm tra URL.',
                    urlRequired: 'Vui lÃ²ng thiáº¿t láº­p URL Google Apps Script trÆ°á»›c!',
                    validationError: 'Vui lÃ²ng Ä‘iá»n táº¥t cáº£ cÃ¡c trÆ°á»ng báº¯t buá»™c!\n\nCÃ¡c trÆ°á»ng báº¯t buá»™c:\n- DATE æ—¥æœŸ\n- M/C æ©Ÿå°\n- QC inspector æª¢é©—å“¡\n- Description æ–™è™Ÿ\n- RESULTçµæœ'
                }
            },
            id: {
                mainTitle: 'Sistem Manajemen Kualitas IPQC',
                cloudBadge: 'â˜ï¸ Cloud',
                subtitle: 'Sistem Manajemen Kontrol Kualitas Dalam Proses',
                connectionStatus: {
                    connected: 'Terhubung',
                    disconnected: 'Tidak terhubung'
                },
                langKo: 'Korea í•œêµ­ì–´',
                langEn: 'Inggris English',
                langZh: 'Mandarin ä¸­æ–‡',
                langVi: 'Vietnam Tiáº¿ng Viá»‡t',
                langId: 'Indonesia Bahasa',
                tabInput: 'Input Data',
                tabQuery: 'Query Data',
                tabStats: 'Statistik',
                tabSettings: 'âš™ï¸ Pengaturan',
                labelEquipment: 'Jumlah Peralatan:',
                btnGenerate: 'Buat Kolom',
                thItem: 'Item',
                btnFillCommon: 'Isi Otomatis Info Umum',
                btnSave: 'Simpan ke Google Sheets',
                btnExcel: 'Ekspor Data Saat Ini',
                btnClear: 'Hapus Semua',
                searchTitle: 'Kriteria Pencarian',
                labelSearchDate: 'Tanggal:',
                labelSearchProduct: 'Produk:',
                btnSearch: 'Cari',
                btnClearSearch: 'Hapus',
                btnRefresh: 'Segarkan Semua Data dari Google Sheets',
                btnExportAll: 'Ekspor Semua Data ke Excel',
                thDate: 'Tanggal',
                thTime: 'Waktu',
                thMachine: 'Mesin',
                thCustomer: 'Pelanggan',
                thDescription: 'Produk',
                thDetail: 'Detail',
                statTotal: 'Total Inspeksi',
                statPass: 'Tingkat Lulus',
                statFail: 'Jumlah Gagal',
                statWeek: 'Inspeksi Mingguan',
                chartTitle1: 'Distribusi Hasil Inspeksi',
                chartTitle2: 'Tren Inspeksi Bulanan',
                settingsTitle: 'Pengaturan Google Sheets',
                settingsDesc: 'Masukkan URL Google Apps Script Web App:',
                btnSaveSettings: 'Simpan Pengaturan',
                btnTestConnection: 'Uji Koneksi',
                guideTitle: 'Panduan Pengaturan',
                codeTitle: 'Kode Apps Script:',
                modalTitle: 'Detail Inspeksi',
                btnView: 'Lihat Detail',
                chartLabels: {
                    ok: 'Lulus',
                    ng: 'Gagal',
                    other: 'Lainnya',
                    result: 'Hasil',
                    count: 'Jumlah',
                    month: 'Bulan',
                    inspections: 'Inspeksi'
                },
                alerts: {
                    saveSuccess: 'Data berhasil disimpan ke Google Sheets!\n(Abaikan peringatan CORS - data tersimpan)',
                    saveError: 'Terjadi kesalahan saat menyimpan.',
                    loadSuccess: 'Data terbaru berhasil dimuat!',
                    loadError: 'Gagal memuat data',
                    noData: 'Tidak ada data tersimpan.',
                    refreshSuccess: 'Semua data berhasil disegarkan!',
                    refreshError: 'Terjadi kesalahan saat menyegarkan',
                    clearConfirm: 'Apakah Anda ingin menghapus semua data input?',
                    settingsSaved: 'Pengaturan berhasil disimpan!',
                    connectionSuccess: 'Koneksi berhasil! Dapat berkomunikasi dengan Google Sheets.',
                    connectionError: 'Koneksi gagal. Silakan periksa URL.',
                    urlRequired: 'Silakan atur URL Google Apps Script terlebih dahulu!',
                    validationError: 'Silakan isi semua bidang wajib!\n\nBidang wajib:\n- DATE æ—¥æœŸ\n- M/C æ©Ÿå°\n- QC inspector æª¢é©—å“¡\n- Description æ–™è™Ÿ\n- RESULTçµæœ'
                }
            }
        };

        let currentLang = 'ko';

        // ê²€ì‚¬ í•­ëª© ì •ì˜ (37ê°œ)
        const inspectionFields = [
            { label: 'DATE æ—¥æœŸ', type: 'date', required: true },
            { label: 'TIME æ™‚é–“', type: 'time', required: false },
            { label: 'M/C æ©Ÿå°', type: 'text', required: true },
            { label: 'SHIFT ç­åˆ¥', type: 'select', options: ['DAY', 'NIGHT', '-'], required: false },
            { label: 'QC inspector æª¢é©—å“¡', type: 'text', required: true },
            { label: 'Description æ–™è™Ÿ', type: 'text', required: true },
            { label: 'Customer', type: 'text', required: false },
            { label: 'MOLD æ¨¡è™Ÿ', type: 'text', required: false },
            { label: 'Datecode', type: 'text', required: false },
            { label: 'LTC No. æ‰¹è™Ÿ', type: 'text', required: false },
            { label: 'VISUALå¤–è§€', type: 'select', options: ['OK', 'NG', '-'], required: false },
            { label: 'OLç¸½é•·', type: 'text', required: false },
            { label: 'OWç¸½å¯¬', type: 'text', required: false },
            { label: 'STå¤–ç–Šåˆé«˜', type: 'text', required: false },
            { label: 'Warpageå½åº¦', type: 'text', required: false },
            { label: 'Where ä½ç½®', type: 'text', required: false },
            { label: 'C/C å‡¹å‡¸åº¦', type: 'text', required: false },
            { label: 'SRè¡¨é¢é›»é˜»', type: 'text', required: false },
            { label: 'Weighté‡é‡', type: 'text', required: false },
            { label: 'RESULTçµæœ', type: 'select', options: ['OK', 'NG', '-'], required: true },
            { label: 'Approval å¯©æ ¸è€…', type: 'text', required: false },
            { label: 'TSMC EL 3ì  æœ€å¤§å€¼', type: 'text', required: false },
            { label: 'ì¼ë°˜ê³ ê° EL', type: 'text', required: false },
            { label: 'TSMC SKH é‡æ¸¬10ì çµæœ', type: 'text', required: false },
            { label: 'TSMC SKH é‡æ¸¬4ì çµæœ', type: 'text', required: false },
            { label: 'TSMC 20ç‰‡ ST é‡æ¸¬4ì  æœ€å¤§å€¼', type: 'text', required: false },
            { label: 'TSMC 20ç‰‡ ST é‡æ¸¬4ì  æœ€å°å€¼', type: 'text', required: false },
            { label: 'TTSMC å–®ç‰‡ST é‡æ¸¬4ì  æœ€å¤§å€¼', type: 'text', required: false },
            { label: 'TSMC å–®ç‰‡ST é‡æ¸¬4ì  æœ€å°å€¼', type: 'text', required: false },
            { label: 'ASE / SPIL SKH é‡æ¸¬ 4ì çµæœ', type: 'text', required: false },
            { label: 'AASEK SRè¡¨é¢é›»é˜» (2pin)', type: 'text', required: false },
            { label: 'å‚™è¨»', type: 'text', required: false },
            { label: 'SESS SRè¡¨é¢é›»é˜» (Trek 152-1) 10V', type: 'text', required: false },
            { label: 'SESS SRè¡¨é¢é›»é˜» (Trek 152-1) 100V', type: 'text', required: false },
            { label: 'ì›ë£Œëª…', type: 'text', required: false },
            { label: 'ì›ë£Œ Lot', type: 'text', required: false },
            { label: 'ì›ë£Œ ETC', type: 'text', required: false }
        ];

        // ğŸ”— ì—°ê²° ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateConnectionStatus(connected) {
            const indicator = document.getElementById('statusIndicator');
            const statusText = document.getElementById('connectionStatus');
            const status = translations[currentLang].connectionStatus;
            
            if (connected) {
                indicator.classList.add('connected');
                statusText.textContent = status.connected;
            } else {
                indicator.classList.remove('connected');
                statusText.textContent = status.disconnected;
            }
        }

        // ğŸŒ ì–¸ì–´ ë³€ê²½
        function changeLanguage(lang) {
            currentLang = lang;
            const t = translations[lang];

            // í—¤ë”
            document.getElementById('mainTitle').textContent = t.mainTitle;
            document.getElementById('cloudBadge').textContent = t.cloudBadge;
            document.getElementById('subtitle').textContent = t.subtitle;

            // ì–¸ì–´ íƒ­
            document.getElementById('langKo').textContent = t.langKo;
            document.getElementById('langEn').textContent = t.langEn;
            document.getElementById('langZh').textContent = t.langZh;
            document.getElementById('langVi').textContent = t.langVi;
            document.getElementById('langId').textContent = t.langId;

            // ë©”ì¸ íƒ­
            document.getElementById('tabInput').textContent = t.tabInput;
            document.getElementById('tabQuery').textContent = t.tabQuery;
            document.getElementById('tabStats').textContent = t.tabStats;
            document.getElementById('tabSettings').textContent = t.tabSettings;

            // ë°ì´í„° ì…ë ¥ íƒ­
            document.getElementById('labelEquipment').textContent = t.labelEquipment;
            document.getElementById('btnGenerate').textContent = t.btnGenerate;
            document.getElementById('thItem').textContent = t.thItem;
            document.getElementById('btnFillCommon').textContent = t.btnFillCommon;
            document.getElementById('btnSave').textContent = t.btnSave;
            document.getElementById('btnExcel').textContent = t.btnExcel;
            document.getElementById('btnClear').textContent = t.btnClear;

            // ë°ì´í„° ì¡°íšŒ íƒ­
            document.getElementById('searchTitle').textContent = t.searchTitle;
            document.getElementById('labelSearchDate').textContent = t.labelSearchDate;
            document.getElementById('labelSearchProduct').textContent = t.labelSearchProduct;
            document.getElementById('btnSearch').textContent = t.btnSearch;
            document.getElementById('btnClearSearch').textContent = t.btnClearSearch;
            document.getElementById('btnRefresh').textContent = t.btnRefresh;
            document.getElementById('btnExportAll').textContent = t.btnExportAll;
            document.getElementById('thDate').textContent = t.thDate;
            document.getElementById('thTime').textContent = t.thTime;
            document.getElementById('thMachine').textContent = t.thMachine;
            document.getElementById('thCustomer').textContent = t.thCustomer;
            document.getElementById('thDescription').textContent = t.thDescription;
            document.getElementById('thDetail').textContent = t.thDetail;

            // í†µê³„ íƒ­
            document.getElementById('statTotal').textContent = t.statTotal;
            document.getElementById('statPass').textContent = t.statPass;
            document.getElementById('statFail').textContent = t.statFail;
            document.getElementById('statWeek').textContent = t.statWeek;
            document.getElementById('chartTitle1').textContent = t.chartTitle1;
            document.getElementById('chartTitle2').textContent = t.chartTitle2;

            // ì„¤ì • íƒ­
            document.getElementById('settingsTitle').textContent = t.settingsTitle;
            document.getElementById('settingsDesc').textContent = t.settingsDesc;
            document.getElementById('btnSaveSettings').textContent = t.btnSaveSettings;
            document.getElementById('btnTestConnection').textContent = t.btnTestConnection;
            document.getElementById('guideTitle').textContent = t.guideTitle;
            document.getElementById('codeTitle').textContent = t.codeTitle;

            // ëª¨ë‹¬
            document.getElementById('modalTitle').textContent = t.modalTitle;

            // ì—°ê²° ìƒíƒœ
            const indicator = document.getElementById('statusIndicator');
            updateConnectionStatus(indicator.classList.contains('connected'));

            // ğŸ¨ ì°¨íŠ¸ ë‹¤êµ­ì–´ ì—…ë°ì´íŠ¸
            updateStatistics();
        }

        // ì´ˆê¸° í…Œì´ë¸” ìƒì„±
        function generateColumns() {
            const count = parseInt(document.getElementById('equipmentCount').value);
            const header = document.getElementById('tableHeader');
            const body = document.getElementById('tableBody');

            // í—¤ë” ì´ˆê¸°í™”
            header.innerHTML = `<th id="thItem">${translations[currentLang].thItem}</th>`;
            for (let i = 1; i <= count; i++) {
                const th = document.createElement('th');
                th.textContent = `Data ${i}`;
                header.appendChild(th);
            }

            // ë³¸ë¬¸ ìƒì„±
            body.innerHTML = '';
            inspectionFields.forEach(field => {
                const row = document.createElement('tr');
                const labelCell = document.createElement('td');
                labelCell.className = 'item-label' + (field.required ? ' required-field' : '');
                labelCell.textContent = field.label;
                row.appendChild(labelCell);

                for (let i = 0; i < count; i++) {
                    const cell = document.createElement('td');
                    let input;

                    if (field.type === 'select') {
                        input = document.createElement('select');
                        field.options.forEach(opt => {
                            const option = document.createElement('option');
                            option.value = opt;
                            option.textContent = opt;
                            input.appendChild(option);
                        });
                    } else {
                        input = document.createElement('input');
                        input.type = field.type;
                    }

                    input.dataset.field = field.label;
                    if (field.required) {
                        input.required = true;
                        input.dataset.required = 'true';
                    }
                    cell.appendChild(input);
                    row.appendChild(cell);
                }

                body.appendChild(row);
            });
        }

        // âœ”ï¸ í•„ìˆ˜ ì…ë ¥ ê²€ì¦
        function validateRequiredFields() {
            const firstColumnInputs = document.querySelectorAll('#tableBody tr td:nth-child(2) input, #tableBody tr td:nth-child(2) select');
            const errors = [];

            firstColumnInputs.forEach(input => {
                input.classList.remove('validation-error');
                if (input.dataset.required === 'true') {
                    if (!input.value || input.value.trim() === '' || input.value === '-') {
                        errors.push(input.dataset.field);
                        input.classList.add('validation-error');
                    }
                }
            });

            if (errors.length > 0) {
                alert(translations[currentLang].alerts.validationError);
                return false;
            }

            return true;
        }

        // ê³µí†µì •ë³´ ìë™ì±„ìš°ê¸°
        function fillCommonData() {
            const rows = document.querySelectorAll('#tableBody tr');
            const count = parseInt(document.getElementById('equipmentCount').value);

            rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                if (cells.length > 1) {
                    const firstInput = cells[1].querySelector('input, select');
                    if (firstInput && firstInput.value) {
                        for (let i = 2; i <= count; i++) {
                            const targetInput = cells[i].querySelector('input, select');
                            if (targetInput) {
                                targetInput.value = firstInput.value;
                            }
                        }
                    }
                }
            });
        }

        // â˜ï¸ Google Sheetsì— ì €ì¥ (ê²€ì¦ ì¶”ê°€)
        async function saveToGoogleSheets() {
            // âœ”ï¸ í•„ìˆ˜ ì…ë ¥ ê²€ì¦
            if (!validateRequiredFields()) {
                return;
            }

            const scriptUrl = localStorage.getItem('googleScriptUrl');
            if (!scriptUrl) {
                alert(translations[currentLang].alerts.urlRequired);
                return;
            }

            const count = parseInt(document.getElementById('equipmentCount').value);
            const rows = document.querySelectorAll('#tableBody tr');

            for (let col = 1; col <= count; col++) {
                const rowData = [];
                rows.forEach(row => {
                    const cell = row.querySelectorAll('td')[col];
                    const input = cell.querySelector('input, select');
                    rowData.push(input ? input.value : '');
                });

                try {
                    await fetch(scriptUrl, {
                        method: 'POST',
                        mode: 'no-cors',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ action: 'save', values: rowData })
                    });

                    // ë¡œì»¬ ì €ì¥ì†Œì—ë„ ë°±ì—…
                    saveToLocalStorage(rowData);
                } catch (error) {
                    console.error('Save error:', error);
                }
            }

            alert(translations[currentLang].alerts.saveSuccess);
            updateConnectionStatus(true);
        }

        // ë¡œì»¬ ì €ì¥ì†Œ ì €ì¥
        function saveToLocalStorage(data) {
            let allData = JSON.parse(localStorage.getItem('ipqcData') || '[]');
            const dataObj = {};
            inspectionFields.forEach((field, index) => {
                dataObj[field.label] = data[index] || '';
            });
            dataObj.timestamp = new Date().toISOString();
            allData.push(dataObj);
            localStorage.setItem('ipqcData', JSON.stringify(allData));
        }

        // Google Sheetsì—ì„œ ìµœì‹  ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
        async function loadLatestDataFromGoogleSheets() {
            const scriptUrl = localStorage.getItem('googleScriptUrl');
            if (!scriptUrl) {
                alert(translations[currentLang].alerts.urlRequired);
                return;
            }

            try {
                document.body.style.cursor = 'wait';
                const response = await fetch(scriptUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: 'load' })
                });

                const result = await response.json();
                if (result.data && result.data.length > 0) {
                    populateTableWithData(result.data);
                    alert(translations[currentLang].alerts.loadSuccess);
                    updateConnectionStatus(true);
                } else {
                    alert(translations[currentLang].alerts.noData);
                }
            } catch (error) {
                console.error('Load error:', error);
                alert(translations[currentLang].alerts.loadError);
            } finally {
                document.body.style.cursor = 'default';
            }
        }

        // ğŸ”§ Google Sheets ì „ì²´ ë°ì´í„° ìƒˆë¡œê³ ì¹¨ (v3.2 - Load failed ìˆ˜ì •)
        async function loadAllDataFromGoogleSheets() {
            const scriptUrl = localStorage.getItem('googleScriptUrl');
            if (!scriptUrl) {
                alert(translations[currentLang].alerts.urlRequired);
                return;
            }

            // URL í˜•ì‹ ê²€ì¦
            if (!scriptUrl.includes('script.google.com')) {
                alert('ì˜¬ë°”ë¥¸ Google Apps Script URLì´ ì•„ë‹™ë‹ˆë‹¤.\n\nURLì€ ë‹¤ìŒ í˜•ì‹ì´ì–´ì•¼ í•©ë‹ˆë‹¤:\nhttps://script.google.com/macros/s/YOUR_SCRIPT_ID/exec');
                return;
            }

            try {
                document.body.style.cursor = 'wait';
                
                // íƒ€ì„ì•„ì›ƒ ì„¤ì • (30ì´ˆ)
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 30000);

                const response = await fetch(scriptUrl, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ action: 'loadAll' }),
                    signal: controller.signal
                });

                clearTimeout(timeoutId);

                // ì‘ë‹µ ìƒíƒœ í™•ì¸
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                // ì‘ë‹µ í…ìŠ¤íŠ¸ í™•ì¸
                const responseText = await response.text();
                console.log('Response:', responseText);

                // JSON íŒŒì‹± ì‹œë„
                let result;
                try {
                    result = JSON.parse(responseText);
                } catch (parseError) {
                    console.error('JSON Parse Error:', parseError);
                    throw new Error('ì„œë²„ ì‘ë‹µì„ íŒŒì‹±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. Apps Script ì½”ë“œë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.');
                }

                // ì‘ë‹µ ì„±ê³µ ì—¬ë¶€ í™•ì¸
                if (result.success === false) {
                    throw new Error(result.error || result.message || 'ì„œë²„ì—ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
                }
                
                // ë°ì´í„° ì²˜ë¦¬
                if (result.data && result.data.length > 0) {
                    const formattedData = result.data.map(row => {
                        const obj = {};
                        inspectionFields.forEach((field, index) => {
                            obj[field.label] = row[index] || '';
                        });
                        return obj;
                    });

                    localStorage.setItem('ipqcData', JSON.stringify(formattedData));
                    updateQueryTable();
                    updateStatistics();
                    
                    const totalMsg = result.totalRows ? ` (${result.totalRows}ê±´)` : '';
                    alert(translations[currentLang].alerts.refreshSuccess + totalMsg);
                    updateConnectionStatus(true);
                } else {
                    // ë°ì´í„°ê°€ ì—†ëŠ” ê²½ìš°
                    localStorage.setItem('ipqcData', '[]');
                    updateQueryTable();
                    updateStatistics();
                    alert(translations[currentLang].alerts.noData);
                    updateConnectionStatus(true);
                }
            } catch (error) {
                console.error('Refresh error:', error);
                updateConnectionStatus(false);
                
                // ìƒì„¸í•œ ì˜¤ë¥˜ ë©”ì‹œì§€
                let errorMsg = translations[currentLang].alerts.refreshError;
                
                if (error.name === 'AbortError') {
                    errorMsg += '\n\nâ±ï¸ íƒ€ì„ì•„ì›ƒ: 30ì´ˆ ë‚´ì— ì‘ë‹µì´ ì—†ìŠµë‹ˆë‹¤.\nì„œë²„ ì‘ë‹µì´ ëŠë¦¬ê±°ë‚˜ ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.';
                } else if (error.message.includes('HTTP')) {
                    errorMsg += '\n\nğŸ”— ' + error.message + '\n\nGoogle Apps Script ë°°í¬ ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”:\n1. ì•¡ì„¸ìŠ¤ ê¶Œí•œ: "ëª¨ë“  ì‚¬ìš©ì"\n2. ë°°í¬ ìƒíƒœ: í™œì„±í™”';
                } else if (error.message.includes('Failed to fetch') || error.message.includes('NetworkError')) {
                    errorMsg += '\n\nğŸŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜\n\nê°€ëŠ¥í•œ ì›ì¸:\n1. ì¸í„°ë„· ì—°ê²° í™•ì¸\n2. Google Apps Script URL í™•ì¸\n3. CORS ì •ì±… - ë¸Œë¼ìš°ì € ì½˜ì†” í™•ì¸\n\nğŸ’¡ í•´ê²°ë°©ë²•:\nâ€¢ URLì´ "/exec"ë¡œ ëë‚˜ëŠ”ì§€ í™•ì¸\nâ€¢ Apps Script ì¬ë°°í¬ í›„ ìƒˆ URL ì‚¬ìš©';
                } else if (error.message.includes('íŒŒì‹±')) {
                    errorMsg += '\n\nğŸ“„ ' + error.message + '\n\ní•´ê²°ë°©ë²•:\n1. Apps Script ì½”ë“œë¥¼ v3.2ë¡œ ì—…ë°ì´íŠ¸\n2. ì½”ë“œ ì €ì¥ í›„ ì¬ë°°í¬\n3. ë¸Œë¼ìš°ì € ì½˜ì†”ì—ì„œ ì‘ë‹µ ë‚´ìš© í™•ì¸';
                } else {
                    errorMsg += '\n\nâŒ ' + error.message;
                }
                
                alert(errorMsg);
            } finally {
                document.body.style.cursor = 'default';
            }
        }

        // í…Œì´ë¸”ì— ë°ì´í„° ì±„ìš°ê¸°
        function populateTableWithData(data) {
            const rows = document.querySelectorAll('#tableBody tr');
            rows.forEach((row, index) => {
                const input = row.querySelectorAll('td')[1].querySelector('input, select');
                if (input && data[index] !== undefined) {
                    input.value = data[index];
                }
            });
        }

        // Excel ì €ì¥
        function saveAllDataToExcel() {
            const count = parseInt(document.getElementById('equipmentCount').value);
            const rows = document.querySelectorAll('#tableBody tr');
            
            let csv = '\uFEFF';
            const headers = [translations[currentLang].thItem];
            for (let i = 1; i <= count; i++) {
                headers.push(`Data ${i}`);
            }
            csv += headers.join(',') + '\n';

            rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                const rowData = [cells[0].textContent];
                for (let i = 1; i <= count; i++) {
                    const input = cells[i].querySelector('input, select');
                    rowData.push(input ? `"${input.value.replace(/"/g, '""')}"` : '');
                }
                csv += rowData.join(',') + '\n';
            });

            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `IPQC_Data_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
        }

        // ì „ì²´ ë°ì´í„° Excel ì €ì¥
        function saveQueryDataToExcel() {
            const data = JSON.parse(localStorage.getItem('ipqcData') || '[]');
            if (data.length === 0) {
                alert(translations[currentLang].alerts.noData);
                return;
            }

            let csv = '\uFEFF';
            const headers = inspectionFields.map(f => f.label);
            csv += headers.join(',') + '\n';

            data.forEach(row => {
                const values = inspectionFields.map(f => {
                    const val = row[f.label] || '';
                    return `"${val.toString().replace(/"/g, '""')}"`;
                });
                csv += values.join(',') + '\n';
            });

            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `IPQC_All_Data_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
        }

        // ğŸ¨ ì°¨íŠ¸ ìƒì„± (ì°¨íŠ¸ ì¸ìŠ¤í„´ìŠ¤ ì™„ì „ ì œê±° ì¶”ê°€)
        let resultChartInstance = null;
        let monthlyChartInstance = null;

        function generateChart() {
            const data = JSON.parse(localStorage.getItem('ipqcData') || '[]');
            const t = translations[currentLang].chartLabels;

            const okCount = data.filter(d => d['RESULTçµæœ'] === 'OK').length;
            const ngCount = data.filter(d => d['RESULTçµæœ'] === 'NG').length;
            const otherCount = data.length - okCount - ngCount;

            const canvas = document.getElementById('resultChart');
            const ctx = canvas.getContext('2d');

            // ğŸ”§ ê¸°ì¡´ ì°¨íŠ¸ ì™„ì „ ì œê±°
            if (resultChartInstance) {
                resultChartInstance.destroy();
                resultChartInstance = null;
            }

            resultChartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: [t.ok, t.ng, t.other],
                    datasets: [{
                        data: [okCount, ngCount, otherCount],
                        backgroundColor: ['#333333', '#999999', '#e0e0e0'],
                        borderColor: '#ffffff',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                font: { size: 14 },
                                color: '#333'
                            }
                        },
                        title: {
                            display: true,
                            text: t.result,
                            font: { size: 16, weight: 'bold' },
                            color: '#333'
                        }
                    }
                }
            });
        }

        function generateMonthlyChart() {
            const data = JSON.parse(localStorage.getItem('ipqcData') || '[]');
            const t = translations[currentLang].chartLabels;
            
            const monthlyData = {};
            data.forEach(item => {
                const date = item['DATE æ—¥æœŸ'];
                if (date) {
                    const month = date.substring(0, 7);
                    monthlyData[month] = (monthlyData[month] || 0) + 1;
                }
            });

            const sortedMonths = Object.keys(monthlyData).sort();
            const counts = sortedMonths.map(m => monthlyData[m]);

            const canvas = document.getElementById('monthlyChart');
            const ctx = canvas.getContext('2d');

            // ğŸ”§ ê¸°ì¡´ ì°¨íŠ¸ ì™„ì „ ì œê±°
            if (monthlyChartInstance) {
                monthlyChartInstance.destroy();
                monthlyChartInstance = null;
            }

            monthlyChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: sortedMonths,
                    datasets: [{
                        label: t.inspections,
                        data: counts,
                        borderColor: '#333',
                        backgroundColor: 'rgba(51, 51, 51, 0.1)',
                        borderWidth: 2,
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                font: { size: 14 },
                                color: '#333'
                            }
                        },
                        title: {
                            display: true,
                            text: t.month,
                            font: { size: 16, weight: 'bold' },
                            color: '#333'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1,
                                color: '#666'
                            },
                            title: {
                                display: true,
                                text: t.count,
                                color: '#333',
                                font: { size: 14, weight: 'bold' }
                            }
                        },
                        x: {
                            ticks: {
                                color: '#666'
                            },
                            title: {
                                display: true,
                                text: t.month,
                                color: '#333',
                                font: { size: 14, weight: 'bold' }
                            }
                        }
                    }
                }
            });
        }

        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStatistics() {
            const data = JSON.parse(localStorage.getItem('ipqcData') || '[]');
            
            const total = data.length;
            const passed = data.filter(e => e['RESULTçµæœ'] === 'OK').length;
            const failed = data.filter(e => e['RESULTçµæœ'] === 'NG').length;
            const passRate = total > 0 ? ((passed / total) * 100).toFixed(1) : 0;

            const weekAgo = new Date();
            weekAgo.setDate(weekAgo.getDate() - 7);
            const weeklyCount = data.filter(e => {
                const date = new Date(e['DATE æ—¥æœŸ']);
                return date >= weekAgo;
            }).length;

            document.getElementById('totalInspections').textContent = total;
            document.getElementById('passRate').textContent = passRate + '%';
            document.getElementById('failCount').textContent = failed;
            document.getElementById('weeklyCount').textContent = weeklyCount;

            generateChart();
            generateMonthlyChart();
        }

        // ë°ì´í„° ì¡°íšŒ
        function updateQueryTable() {
            const data = JSON.parse(localStorage.getItem('ipqcData') || '[]');
            const tbody = document.getElementById('queryTableBody');
            const t = translations[currentLang];
            tbody.innerHTML = '';

            data.forEach((item, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item['DATE æ—¥æœŸ'] || '-'}</td>
                    <td>${item['TIME æ™‚é–“'] || '-'}</td>
                    <td>${item['M/C æ©Ÿå°'] || '-'}</td>
                    <td>${item['Customer'] || '-'}</td>
                    <td>${item['Description æ–™è™Ÿ'] || '-'}</td>
                    <td><button class="btn-view" onclick="showDetail(${index})">${t.btnView}</button></td>
                `;
                tbody.appendChild(row);
            });
        }

        function searchData() {
            const searchDate = document.getElementById('searchDate').value;
            const searchProduct = document.getElementById('searchProduct').value.toLowerCase();
            const data = JSON.parse(localStorage.getItem('ipqcData') || '[]');
            const tbody = document.getElementById('queryTableBody');
            const t = translations[currentLang];
            tbody.innerHTML = '';

            const filtered = data.filter(item => {
                const dateMatch = !searchDate || item['DATE æ—¥æœŸ'] === searchDate;
                const productMatch = !searchProduct || 
                    (item['Description æ–™è™Ÿ'] && item['Description æ–™è™Ÿ'].toLowerCase().includes(searchProduct));
                return dateMatch && productMatch;
            });

            filtered.forEach((item, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item['DATE æ—¥æœŸ'] || '-'}</td>
                    <td>${item['TIME æ™‚é–“'] || '-'}</td>
                    <td>${item['M/C æ©Ÿå°'] || '-'}</td>
                    <td>${item['Customer'] || '-'}</td>
                    <td>${item['Description æ–™è™Ÿ'] || '-'}</td>
                    <td><button class="btn-view" onclick="showDetail(${data.indexOf(item)})">${t.btnView}</button></td>
                `;
                tbody.appendChild(row);
            });
        }

        function clearSearch() {
            document.getElementById('searchDate').value = '';
            document.getElementById('searchProduct').value = '';
            updateQueryTable();
        }

        function showDetail(index) {
            const data = JSON.parse(localStorage.getItem('ipqcData') || '[]');
            const item = data[index];
            const table = document.getElementById('detailTable');
            table.innerHTML = '';

            inspectionFields.forEach(field => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <th>${field.label}</th>
                    <td>${item[field.label] || '-'}</td>
                `;
                table.appendChild(row);
            });

            document.getElementById('detailModal').style.display = 'block';
        }

        function closeDetailModal() {
            document.getElementById('detailModal').style.display = 'none';
        }

        // ì „ì²´ ì´ˆê¸°í™”
        function clearAllData() {
            if (confirm(translations[currentLang].alerts.clearConfirm)) {
                const rows = document.querySelectorAll('#tableBody tr');
                rows.forEach(row => {
                    const inputs = row.querySelectorAll('input, select');
                    inputs.forEach(input => {
                        if (input.type === 'date') {
                            input.value = new Date().toISOString().split('T')[0];
                        } else if (input.type === 'time') {
                            input.value = new Date().toTimeString().split(' ')[0].substring(0, 5);
                        } else {
                            input.value = '';
                        }
                        input.classList.remove('validation-error');
                    });
                });
            }
        }

        // ğŸ“‹ ì½”ë“œ ë³µì‚¬ ê¸°ëŠ¥
        function copyScriptCode() {
            const code = `function doPost(e) {
  const sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();
  const data = JSON.parse(e.postData.contents);
  
  if (data.action === 'save') {
    const values = data.values;
    sheet.appendRow(values);
    return ContentService.createTextOutput(JSON.stringify({success: true}));
  }
  
  if (data.action === 'load') {
    const lastRow = sheet.getLastRow();
    if (lastRow < 2) return ContentService.createTextOutput(JSON.stringify({data: []}));
    const values = sheet.getRange(lastRow, 1, 1, sheet.getLastColumn()).getValues()[0];
    return ContentService.createTextOutput(JSON.stringify({data: values}));
  }
  
  if (data.action === 'loadAll') {
    const lastRow = sheet.getLastRow();
    if (lastRow < 2) return ContentService.createTextOutput(JSON.stringify({data: []}));
    const values = sheet.getRange(2, 1, lastRow - 1, sheet.getLastColumn()).getValues();
    return ContentService.createTextOutput(JSON.stringify({data: values}));
  }
}

function doGet(e) {
  return ContentService.createTextOutput(JSON.stringify({status: 'ok', message: 'IPQC System Connected'}));
}`;

            // í´ë¦½ë³´ë“œì— ë³µì‚¬
            navigator.clipboard.writeText(code).then(() => {
                alert('âœ… ì½”ë“œê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nApps Script í¸ì§‘ê¸°ì— ë¶™ì—¬ë„£ì–´ì£¼ì„¸ìš”.');
            }).catch(err => {
                // ë³µì‚¬ ì‹¤íŒ¨ ì‹œ ëŒ€ì•ˆ ë°©ë²•
                const textarea = document.createElement('textarea');
                textarea.value = code;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                alert('âœ… ì½”ë“œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
            });
        }

        // ì„¤ì • ì €ì¥
        function saveSettings() {
            const url = document.getElementById('googleScriptUrl').value;
            if (url) {
                localStorage.setItem('googleScriptUrl', url);
                alert(translations[currentLang].alerts.settingsSaved);
                testConnection();
            }
        }

        // ì—°ê²° í…ŒìŠ¤íŠ¸ (ê°œì„ ëœ ë²„ì „)
        async function testConnection() {
            const scriptUrl = localStorage.getItem('googleScriptUrl');
            if (!scriptUrl) {
                alert(translations[currentLang].alerts.urlRequired);
                return;
            }

            // URL í˜•ì‹ ê²€ì¦
            if (!scriptUrl.includes('script.google.com') || !scriptUrl.includes('/exec')) {
                alert('âŒ ì˜¬ë°”ë¥¸ Google Apps Script URLì´ ì•„ë‹™ë‹ˆë‹¤.\n\nâœ… ì˜¬ë°”ë¥¸ í˜•ì‹:\nhttps://script.google.com/macros/s/YOUR_SCRIPT_ID/exec\n\ní˜„ì¬ URL:\n' + scriptUrl);
                updateConnectionStatus(false);
                return;
            }

            try {
                document.body.style.cursor = 'wait';
                
                // GET ìš”ì²­ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ (ë” ì•ˆì •ì )
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 10000);

                const response = await fetch(scriptUrl, {
                    method: 'GET',
                    signal: controller.signal
                });

                clearTimeout(timeoutId);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const result = await response.json();
                
                if (result.status === 'ok') {
                    alert('âœ… ' + translations[currentLang].alerts.connectionSuccess + '\n\nì„œë²„ ì‘ë‹µ: ' + (result.message || 'OK'));
                    updateConnectionStatus(true);
                } else {
                    alert('âš ï¸ ì—°ê²°ë¨, í•˜ì§€ë§Œ ì˜ˆìƒì¹˜ ëª»í•œ ì‘ë‹µ\n\nì‘ë‹µ ë‚´ìš©: ' + JSON.stringify(result));
                    updateConnectionStatus(true);
                }
            } catch (error) {
                console.error('Connection test error:', error);
                updateConnectionStatus(false);
                
                let errorMsg = 'âŒ ' + translations[currentLang].alerts.connectionError;
                
                if (error.name === 'AbortError') {
                    errorMsg += '\n\nâ±ï¸ íƒ€ì„ì•„ì›ƒ: 10ì´ˆ ë‚´ì— ì‘ë‹µì´ ì—†ìŠµë‹ˆë‹¤.';
                } else if (error.message.includes('HTTP')) {
                    errorMsg += '\n\n' + error.message;
                } else {
                    errorMsg += '\n\n' + error.message;
                }
                
                errorMsg += '\n\nğŸ” ì²´í¬ë¦¬ìŠ¤íŠ¸:\nâ–¡ URLì´ /execë¡œ ëë‚˜ëŠ”ê°€?\nâ–¡ Apps Scriptê°€ "ì›¹ ì•±"ìœ¼ë¡œ ë°°í¬ë˜ì—ˆëŠ”ê°€?\nâ–¡ ì•¡ì„¸ìŠ¤ ê¶Œí•œì´ "ëª¨ë“  ì‚¬ìš©ì"ì¸ê°€?\nâ–¡ ì¸í„°ë„· ì—°ê²°ì´ ì •ìƒì¸ê°€?';
                
                alert(errorMsg);
            } finally {
                document.body.style.cursor = 'default';
            }
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.addEventListener('DOMContentLoaded', function() {
            // ì–¸ì–´ íƒ­
            document.querySelectorAll('.lang-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('.lang-tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    changeLanguage(this.dataset.lang);
                });
            });

            // ë©”ì¸ íƒ­
            document.querySelectorAll('.main-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('.main-tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    this.classList.add('active');
                    document.getElementById('content-' + this.dataset.tab).classList.add('active');

                    if (this.dataset.tab === 'stats') {
                        updateStatistics();
                    } else if (this.dataset.tab === 'query') {
                        updateQueryTable();
                    }
                });
            });

            // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
            window.onclick = function(event) {
                const modal = document.getElementById('detailModal');
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            };

            // ì´ˆê¸° ì„¤ì •
            generateColumns();
            const savedUrl = localStorage.getItem('googleScriptUrl');
            if (savedUrl) {
                document.getElementById('googleScriptUrl').value = savedUrl;
                updateConnectionStatus(true);
            }

            // ì´ˆê¸° ë‚ ì§œ/ì‹œê°„ ì„¤ì •
            const today = new Date().toISOString().split('T')[0];
            const now = new Date().toTimeString().split(' ')[0].substring(0, 5);
            const dateInputs = document.querySelectorAll('input[type="date"]');
            const timeInputs = document.querySelectorAll('input[type="time"]');
            dateInputs.forEach(input => input.value = today);
            timeInputs.forEach(input => input.value = now);
        });
    </script>
</body>
</html>